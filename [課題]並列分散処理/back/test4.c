#include  <stdio.h>#include <stdlib.h>#include <math.h>#include "MT.h"#include <time.h>#include <mpi.h>void RadixSort(int x[ ], int n, int r);void ShowData(unsigned long x[ ], int n);#define NUM_DATA 16#define M 2#define MASK 1static voidarray_random_number(int *array, unsigned int size, unsigned int digit){    int i;    /* 起動毎に異なる乱数を発生させる */    //srand((unsigned int)time(NULL));	srand(10);	for(i = 0; i < size; i++){        array[i]=rand() % digit;    }}void ShowData(unsigned long x[ ], int n){    int i;    for (i = 0; i < n ; i++)        printf("%ld\n", x[i]);}void ShowData2(int x[ ], int n){    int i;    for (i = 0; i < n ; i++)        printf("%d\n", x[i]);}int array_add(unsigned long array[], unsigned long add){int e_size = 0;array[e_size] = add;e_size = e_size + 1;return e_size;}int bitcount(unsigned long n){    n = n - ((n >> 1) & 033333333333) - ((n >> 2) & 011111111111);    return ((n + (n >> 3)) & 030707070707) % 077 +10;}int bit_max(unsigned long n[ ]){	int i,max=0;	for(i=0;i<NUM_DATA;i++){		if(bitcount(n[i])>max){			max=bitcount(n[i]);		}	}	return max;}voidallocate(unsigned long array[], unsigned int size, int prc_num){    int i, bit; 	int count[2]={0,size};	int count2[M];	unsigned long buf[size];	int d_prc=size/prc_num;	int count3[50]={0};	bit=31;    //for(bit = 31; bit >= 31; bit -= 1){ 		/* 度数分布を求める */		//ShowData(array, size);		for(i = 0; i < M; ++i) count[i] = 0; 		for(i = 0; i < size; ++i){ ++count[(array[i] >> bit) & MASK];}		for(i = 0; i < M; ++i) count2[i] = count[i];		for(i = 1; i < M; ++i) count[i] += count[i-1];		/* 度数分布に従ってデータを整列する */		//printf("%d : \n",count[1]);		ShowData2(count, 2);	//ShowData(array,size);		for(i = size-1; i>=0; --i){			buf[--count[(array[i] >> bit) & MASK]] = array[i];		}		//ShowData(buf,size);		for(i=0; i<size; ++i) array[i] = buf[i]; 		printf("[%02d bit]:", bit); ShowData(array, size);		//for(i=0; i<cou)	//} 	}voidsort_part(unsigned long array[], int prc_num){	int i, bit; 	int size=NUM_DATA;	int count[2]={0,size};	int count2[M];	unsigned long buf[size];	int d_prc=size/prc_num;	int count3[50]={0};	bit=31;    //for(bit = 31; bit >= 31; bit -= 1){ 		/* 度数分布を求める */		//ShowData(array, size);		for(i = 0; i < M; ++i) count[i] = 0; 		for(i = 0; i < size; ++i){ ++count[(array[i] >> bit) & MASK];}		for(i = 0; i < M; ++i) count2[i] = count[i];		for(i = 1; i < M; ++i) count[i] += count[i-1];				/* 度数分布に従ってデータを整列する */		//printf("%d : \n",count[1]);		//ShowData2(count, 2);	//ShowData(array,size);		for(i = size-1; i>=0; --i){			buf[--count[(array[i] >> bit) & MASK]] = array[i];		}	//ShowData(buf,size);		for(i=0; i<size; ++i) array[i] = buf[i]; 	unsigned long buf0[count2[0]];	unsigned long buf1[count2[1]];	int k=0,l=0;	for(i=0;i<size;i++){		if(i<count2[0]){			buf0[k]=array[i];			k++;		}else{			//printf("%ld ::\n",array[i]);			buf1[l]=array[i];			l++;		}	}	//printf("\n buf[0]:"); ShowData(buf0, count2[0]);	//printf("\n buf[1]:"); ShowData(buf1, count2[1]);		int size1=count2[0];	int size2=count2[1];	bit=30;	//buf0		for(i = 0; i < M; ++i) count[i] = 0; 		for(i = 0; i < size1; ++i){ ++count[(buf0[i] >> bit) & MASK];}		for(i = 0; i < M; ++i) count2[i] = count[i];		for(i = 1; i < M; ++i) count[i] += count[i-1];				/* 度数分布に従ってデータを整列する */		//printf("%d : \n",count[1]);		//ShowData2(count, 2);	//ShowData(buf0,4);		for(i = size1-1; i>=0; --i){			buf[--count[(buf0[i] >> bit) & MASK]] = buf0[i];		}	//ShowData(buf,size);		for(i=0; i<size1; ++i) buf0[i] = buf[i]; 	unsigned long buf00[count2[0]];	unsigned long buf11[count2[1]];	count3[0]=count2[0];	count3[1]=count2[1];	k=0;	l=0;	for(i=0;i<size1;i++){		if(i<count2[0]){			buf00[k]=buf0[i];			k++;		}else{			buf11[l]=buf0[i];			l++;		}	}		//buf1		for(i = 0; i < M; ++i) count[i] = 0; 		for(i = 0; i < size2; ++i){ ++count[(buf1[i] >> bit) & MASK];}		for(i = 0; i < M; ++i) count2[i] = count[i];		for(i = 1; i < M; ++i) count[i] += count[i-1];				/* 度数分布に従ってデータを整列する */		//printf("%d : \n",count[1]);		//ShowData2(count, 2);	//ShowData(array,size);		for(i = size2-1; i>=0; --i){			buf[--count[(buf1[i] >> bit) & MASK]] = buf1[i];		}	//ShowData(buf,size);		for(i=0; i<size2; ++i) buf1[i] = buf[i]; 	unsigned long buf22[count2[0]];	unsigned long buf33[count2[1]];	count3[2]=count2[0];	count3[3]=count2[1];	k=0;	l=0;		for(i=0;i<size2;i++){		if(i<count2[0]){			buf22[k]=buf1[i];			k++;		}else{			buf33[l]=buf1[i];			l++;		}	}	//printf("\n[%02d bit]:", bit); ShowData(array, size);		//} 	//printf("\n buf[00]:"); ShowData(buf00, count3[0]);	//printf("\n buf[11]:"); ShowData(buf11, count3[1]);	//printf("\n buf[22]:"); ShowData(buf22, count3[2]);	//printf("\n buf[33]:"); ShowData(buf33, count3[3]);	}int main(int argc, char *argv[]){      /* ソートするデータ */	/* 乱数生成 */	clock_t start,end;	unsigned long data[NUM_DATA],array[NUM_DATA];	int numprocs, rank, namelen;	MPI_Init(&argc, &argv);	MPI_Comm_size(MPI_COMM_WORLD, &numprocs);	MPI_Comm_rank(MPI_COMM_WORLD, &rank);		int i,bit,max_b;	int count[NUM_DATA];	init_genrand(10);	for(i=0;i<NUM_DATA;i++){  		array[i]=genrand_int32();	}	//printf("%ld",sizeof(data)/4);	//ShowData(data, NUM_DATA);	start = clock();		//sort_part(data,4);		int prc_num=4;	int size=NUM_DATA;	int count2[M];	unsigned long buf[size];	int d_prc=size/prc_num;	int count3[50]={0};	bit=31;    //for(bit = 31; bit >= 31; bit -= 1){ 		/* 度数分布を求める */		//ShowData(array, size);		for(i = 0; i < M; ++i) count[i] = 0; 		for(i = 0; i < size; ++i){ ++count[(array[i] >> bit) & MASK];}		for(i = 0; i < M; ++i) count2[i] = count[i];		for(i = 1; i < M; ++i) count[i] += count[i-1];				/* 度数分布に従ってデータを整列する */		//printf("%d : \n",count[1]);		//ShowData2(count, 2);	//ShowData(array,size);		for(i = size-1; i>=0; --i){			buf[--count[(array[i] >> bit) & MASK]] = array[i];		}	//ShowData(buf,size);		for(i=0; i<size; ++i) array[i] = buf[i]; 	unsigned long buf0[count2[0]];	unsigned long buf1[count2[1]];	int k=0,l=0;	for(i=0;i<size;i++){		if(i<count2[0]){			buf0[k]=array[i];			k++;		}else{			//printf("%ld ::\n",array[i]);			buf1[l]=array[i];			l++;		}	}	//printf("\n buf[0]:"); ShowData(buf0, count2[0]);	//printf("\n buf[1]:"); ShowData(buf1, count2[1]);		int size1=count2[0];	int size2=count2[1];	bit=30;	//buf0		for(i = 0; i < M; ++i) count[i] = 0; 		for(i = 0; i < size1; ++i){ ++count[(buf0[i] >> bit) & MASK];}		for(i = 0; i < M; ++i) count2[i] = count[i];		for(i = 1; i < M; ++i) count[i] += count[i-1];				/* 度数分布に従ってデータを整列する */		//printf("%d : \n",count[1]);		//ShowData2(count, 2);	//ShowData(buf0,4);		for(i = size1-1; i>=0; --i){			buf[--count[(buf0[i] >> bit) & MASK]] = buf0[i];		}	//ShowData(buf,size);		for(i=0; i<size1; ++i) buf0[i] = buf[i]; 	unsigned long buf00[count2[0]];	unsigned long buf11[count2[1]];	count3[0]=count2[0];	count3[1]=count2[1];	k=0;	l=0;	for(i=0;i<size1;i++){		if(i<count2[0]){			buf00[k]=buf0[i];			k++;		}else{			buf11[l]=buf0[i];			l++;		}	}		//buf1		for(i = 0; i < M; ++i) count[i] = 0; 		for(i = 0; i < size2; ++i){ ++count[(buf1[i] >> bit) & MASK];}		for(i = 0; i < M; ++i) count2[i] = count[i];		for(i = 1; i < M; ++i) count[i] += count[i-1];				/* 度数分布に従ってデータを整列する */		//printf("%d : \n",count[1]);		//ShowData2(count, 2);	//ShowData(array,size);		for(i = size2-1; i>=0; --i){			buf[--count[(buf1[i] >> bit) & MASK]] = buf1[i];		}	//ShowData(buf,size);		for(i=0; i<size2; ++i) buf1[i] = buf[i]; 	unsigned long buf22[count2[0]];	unsigned long buf33[count2[1]];	count3[2]=count2[0];	count3[3]=count2[1];	k=0;	l=0;		for(i=0;i<size2;i++){		if(i<count2[0]){			buf22[k]=buf1[i];			k++;		}else{			buf33[l]=buf1[i];			l++;		}	}	//printf("\n[%02d bit]:", bit); ShowData(array, size);		if(rank == 0){			}else if(rank == 1){			}else if(rank == 2){			}else if(rank == 3){			}	//} 	//printf("\n buf[00]:"); ShowData(buf00, count3[0]);	//printf("\n buf[11]:"); ShowData(buf11, count3[1]);	//printf("\n buf[22]:"); ShowData(buf22, count3[2]);	//printf("\n buf[33]:"); ShowData(buf33, count3[3]);							//ShowData(data, NUM_DATA);	end = clock();	printf("%.8f秒かかりました\n",(double)(end-start)/CLOCKS_PER_SEC);	}